import { A as G } from "./AppBar-CL-OfsFA.js";
import { a as h } from "./axios-upsvKRUO.js";
import { C as V } from "./CopyrightFooter-BTH_ji-_.js";
import { j as e, u as M, r as s } from "./index-DJ0IS-oA.js";
function te(){const i=M(),[c,v]=s.useState(window.innerWidth),[g,k]=s.useState(""),[q,C]=s.useState(""),[Y,S]=s.useState(""),[H,N]=s.useState(""),[J,I]=s.useState(""),[K,R]=s.useState(""),[r,l]=s.useState({}),[A,B]=s.useState(null),[_,x]=s.useState(!1),[w,u]=s.useState(null);s.useState(!1),s.useState(null);const[T,p]=s.useState(!1),[o,W]=s.useState(""),[a,E]=s.useState(""),[j,m]=s.useState("");s.useEffect(()=>{const t=()=>v(window.innerWidth);window.addEventListener("resize",t);const n=window.localStorage.getItem("nickname")||"",d=window.localStorage.getItem("gender_type")||"",y=window.localStorage.getItem("token")||"",U=window.localStorage.getItem("chat_id")||"",O=window.localStorage.getItem("chat_token")||"",b=window.localStorage.getItem("u_id")||"";if(C(n),R(d),k(y),S(U),N(O),I(b),d==="FEMALE"){i("/home-woman");return}if(!d){i("/home");return}return!window.WebSocketObject&&typeof window.WebSocketConnect=="function"&&window.WebSocketConnect(b),z(y),()=>{window.removeEventListener("resize",t)}},[]),s.useCallback(()=>{let t=2;return c>960&&(t=3),((c>800?800:c)-30)/t},[c]);const P=t=>{if(t&&t!==""){const n=Date.now()-new Date(t).getTime(),d=new Date(n);return", "+Math.abs(d.getUTCFullYear()-1970).toString()+"歲"}return""},D=t=>t?t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"",z=async t=>{try{const n=await h.get("https://api.dageiwo.com/auth/info",{headers:{Authorization:`Bearer ${t}`}});n.status===200&&n.data.success&&(l(n.data.data),B(n.data.data.avatar_url))}catch(n){console.error("RetrieveInfo error:",n)}},f=async()=>{try{u(null);const t={nickname:r.nickname,birthday:r.birthday,notify_telegram:r.notify_telegram},n=await h.put("https://api.dageiwo.com/api/user",t,{headers:{Authorization:`Bearer ${g}`}});n.status===200&&n.data.success?x(!1):u("更新檔案發生錯誤, 請檢查網路後重試一次.")}catch(t){console.error("UpdateInfo error:",t),u("更新檔案發生錯誤, 請檢查網路後重試一次.")}},$=async()=>{try{m("");const t={phone_number:"someNumber",new_pwd:o},n=await h.post("https://api.dageiwo.com/auth/forget/pwd",t);n.status===200&&n.data.success?(m("重設密碼成功."),p(!1)):m("重設密碼失敗, 請檢查網路, 再試一次.")}catch(t){console.error("ResetPassword error:",t),m("重設密碼失敗, 請檢查網路, 再試一次.")}},F=()=>{window.location.assign("https://line.me/R/ti/p/@668pwyqo")},L=async()=>{try{const t=await h.post("https://api.dageiwo.com/auth/logout",{},{headers:{Authorization:`Bearer ${g}`}});t.status===200&&t.data.success&&(window.localStorage.setItem("nickname",""),window.localStorage.setItem("gender_type",""),window.localStorage.setItem("token",""),window.localStorage.setItem("chat_id",""),window.localStorage.setItem("chat_token",""),window.localStorage.setItem("u_id",""),window.WebSocketObject&&window.WebSocketObject.close(),i("/home"))}catch(t){console.error("logout error:",t),i("/home")}};return e.jsxs(e.Fragment,{children:[e.jsx(G,{children:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx("button",{style:{background:"none",border:"none",color:"#fff",cursor:"pointer"},onClick:()=>i(-1),children:e.jsx("i",{className:"mdi mdi-chevron-left",style:{fontSize:"24px"}})}),e.jsx("h2",{style:{margin:"0 auto"},children:"個人檔案"})]})}),r&&e.jsxs("div",{className:"info-main",style:{maxWidth:"800px",margin:"0 auto",padding:"1rem"},children:[e.jsxs("div",{style:{display:"flex",marginBottom:"1rem",alignItems:"center"},children:[e.jsx("div",{style:{flex:"0 0 auto",marginRight:"20px"},children:e.jsx("div",{style:{width:"96px",height:"96px",borderRadius:"50%",border:"2px solid #f2e9eb",outline:"#dd8ea4 solid 2px",overflow:"hidden"},children:e.jsx("img",{src:A||"/images/placeholder.png",alt:"Avatar",style:{width:"100%",height:"100%",objectFit:"cover"}})})}),e.jsx("div",{children:e.jsxs("h3",{children:[r.nickname,P(r.birthday)]})}),e.jsx("div",{style:{marginLeft:"auto"},children:e.jsx("button",{style:{borderRadius:"4px",backgroundColor:"#dd8ea4",color:"#fff",border:"none",padding:"8px 16px",cursor:"pointer"},onClick:()=>x(!0),children:"編輯檔案"})})]}),e.jsx("div",{style:{margin:"20px 5px 10px 5px",display:"flex",justifyContent:"center"},children:e.jsxs("div",{style:{background:"#fff",borderRadius:"16px",width:"90%",padding:"1rem"},children:[e.jsx("div",{style:{textAlign:"center",marginBottom:"1rem",color:"purple"},children:e.jsx("h3",{children:"金幣"})}),e.jsx("div",{style:{textAlign:"center",marginBottom:"1rem"},children:e.jsxs("h1",{children:[D(r.coin),"點"]})}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx("button",{style:{borderRadius:"8px",backgroundColor:"#dd8ea4",color:"#fff",border:"none",padding:"8px 16px",width:"80%",cursor:"pointer"},onClick:()=>i("/purchase/deposit"),children:e.jsx("h3",{children:"前往儲值"})})})]})}),e.jsx("div",{style:{margin:"5px",display:"flex",justifyContent:"center"},children:e.jsxs("div",{style:{background:"#fff",borderRadius:"16px",width:"90%",padding:"1rem"},children:[e.jsxs("div",{className:"menu-item",onClick:()=>i("/deposit-record"),children:[e.jsx("h3",{children:"金幣紀錄"}),e.jsx("i",{className:"mdi mdi-chevron-right"})]}),e.jsxs("div",{className:"menu-item",onClick:()=>i("/transactions-chat-record"),children:[e.jsx("h3",{children:"訊息紀錄"}),e.jsx("i",{className:"mdi mdi-chevron-right"})]}),e.jsxs("div",{className:"menu-item",onClick:()=>i("/transactions-record/CALL"),children:[e.jsx("h3",{children:"通話紀錄"}),e.jsx("i",{className:"mdi mdi-chevron-right"})]}),e.jsxs("div",{className:"menu-item",onClick:()=>i("/transactions-record/VIDEO"),children:[e.jsx("h3",{children:"直播紀錄"}),e.jsx("i",{className:"mdi mdi-chevron-right"})]}),e.jsxs("div",{className:"menu-item",onClick:()=>p(!0),children:[e.jsx("h3",{children:"更改密碼"}),e.jsx("i",{className:"mdi mdi-chevron-right"})]}),e.jsx("hr",{}),e.jsxs("div",{className:"menu-item",children:[e.jsx("h3",{children:"通知開關"}),e.jsx("input",{type:"checkbox",checked:r.notify_telegram||!1,onChange:()=>{const t={...r,notify_telegram:!r.notify_telegram};l(t),f()}})]}),e.jsx("hr",{}),e.jsxs("div",{className:"menu-item",onClick:F,children:[e.jsx("h3",{children:"聯絡客服"}),e.jsx("i",{className:"mdi mdi-chevron-right"})]}),e.jsx("div",{style:{textAlign:"center",marginTop:"1rem"},children:e.jsx("button",{style:{borderRadius:"8px",background:"none",color:"#dd8ea4",border:"2px solid #dd8ea4",padding:"8px 16px",width:"80%",cursor:"pointer"},onClick:L,children:e.jsx("h3",{children:"登出"})})})]})})]}),_&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{className:"modal-close",onClick:()=>x(!1),children:e.jsx("i",{className:"mdi mdi-close"})}),e.jsx("h3",{style:{textAlign:"center"},children:"修改個人檔案"}),e.jsxs("div",{style:{margin:"10px"},children:[e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"4px"},children:"暱稱"}),e.jsx("input",{type:"text",style:{width:"100%",padding:"0.5rem",borderRadius:"4px",border:"1px solid #ccc"},value:r.nickname||"",onChange:t=>l({...r,nickname:t.target.value})})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"4px"},children:"生日"}),e.jsx("input",{type:"date",style:{width:"100%",padding:"0.5rem",borderRadius:"4px",border:"1px solid #ccc"},value:r.birthday||"",onChange:t=>l({...r,birthday:t.target.value})})]}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx("button",{style:{backgroundColor:"#dd8ea4",color:"#fff",padding:"8px 16px",border:"none",borderRadius:"4px",cursor:"pointer"},onClick:f,children:"儲存"})}),w&&e.jsx("div",{style:{textAlign:"center",color:"red",marginTop:"1rem"},children:w})]})]})}),T&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{className:"modal-close",onClick:()=>p(!1),children:e.jsx("i",{className:"mdi mdi-close"})}),e.jsx("h3",{style:{textAlign:"center"},children:"重設密碼"}),e.jsxs("div",{style:{margin:"10px"},children:[e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"4px"},children:"輸入新密碼"}),e.jsx("input",{type:"password",style:{width:"100%",padding:"0.5rem",borderRadius:"4px",border:"1px solid #ccc"},value:o,onChange:t=>W(t.target.value)})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"4px"},children:"再輸入一次新密碼"}),e.jsx("input",{type:"password",style:{width:"100%",padding:"0.5rem",borderRadius:"4px",border:"1px solid #ccc"},value:a,onChange:t=>E(t.target.value)})]}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx("button",{style:{backgroundColor:o!==""&&a!==""&&o===a?"#dd8ea4":"#ccc",color:"#fff",padding:"8px 16px",border:"none",borderRadius:"4px",cursor:o!==""&&a!==""&&o===a?"pointer":"not-allowed"},onClick:$,disabled:o===""||a===""||o!==a,children:"重設密碼"})}),j&&e.jsx("div",{style:{textAlign:"center",color:"red",marginTop:"1rem"},children:j})]})]})}),e.jsx(V,{})]})}export { te as default };

