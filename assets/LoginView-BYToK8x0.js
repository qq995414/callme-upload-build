import { A as X } from "./AppBar-CL-OfsFA.js";
import { a as m } from "./axios-upsvKRUO.js";
import { C as Y } from "./CopyrightFooter-BTH_ji-_.js";
import { j as e, u as J, r as o, m as O } from "./index-DJ0IS-oA.js";
const te=()=>{const j=J(),[q,R]=o.useState([]),[n,P]=o.useState(""),[t,I]=o.useState(""),[p,A]=o.useState(!1),[h,$]=o.useState(""),[N,y]=o.useState(""),[V,w]=o.useState(!1),[g,M]=o.useState(""),[v,i]=o.useState(""),[b,d]=o.useState(""),[D,x]=o.useState(!1),[l,E]=o.useState(""),[f,z]=o.useState(""),[C,u]=o.useState("");o.useEffect(()=>{window.AppConfig&&window.AppConfig.country_list&&R(window.AppConfig.country_list)},[]);const U=()=>{w(!0),S()},S=async()=>{try{i("");const s=await m.post(`https://api.dageiwo.com/auth/forget/send/sms_key?phone_number=${encodeURIComponent(n+t)}`,{});s.status===200&&s.data.success?i("發送成功，請輸入驗證碼"):i("發送驗證碼失敗，請稍後重試")}catch(s){console.error(s),i("發送驗證碼失敗，請檢查網路")}},B=async()=>{try{d("");const s=await m.post(`https://api.dageiwo.com/auth/check/sms_key?phone_number=${encodeURIComponent(n+t)}&key=${g}`,{});s.status===200&&s.data.success?(d("驗證碼正確！"),w(!1),x(!0)):d("驗證失敗，請重試")}catch(s){console.error(s),d("驗證失敗，請檢查網路")}},L=async()=>{try{u("");const s={phone_number:n+t,new_pwd:l},a=await m.post("https://api.dageiwo.com/auth/forget/pwd",s);a.status===200&&a.data.success?(u("重設成功，請使用新密碼登入"),x(!1)):u("重設密碼失敗，請稍後重試")}catch(s){console.error(s),u("重設密碼失敗，請檢查網路")}},T=async()=>{try{y("");const s=await m.post("https://api.dageiwo.com/auth/login",{account:n+t,password:h},{headers:{"Content-Type":"application/json"}});if(s.status===200&&s.data.success){const{nickname:a,gender_type:k,token:_,chat_id:K,chat_token:W,u_id:Z,sendbird_user_id:G,sendbird_access_token:H}=s.data.data;window.localStorage.setItem("nickname",a),window.localStorage.setItem("gender_type",k),window.localStorage.setItem("token",_),window.localStorage.setItem("chat_id",K),window.localStorage.setItem("chat_token",W),window.localStorage.setItem("u_id",Z),window.localStorage.setItem("sendbird_access_token",H),window.localStorage.setItem("sendbird_user_id",G),O.getToken({vapidKey:"BG_gRby09vE3Ra8iOuwxR3NCHscoM1YWlS02umXeMSZxo1UyxopnVhZlh0slHixC3nrCvDQjXxl52Kl5YwnNAT8"}).then(c=>{c?(console.log("FCM Token:",c),fetch(`https://api.dageiwo.com/api/user/device_token?device_token=${c}`,{method:"PUT",headers:{Authorization:`Bearer ${_}`,"Content-Type":"application/json"},body:JSON.stringify({device_token:c})}).then(r=>r.json()).then(r=>{console.log("Device token sent successfully:",r),j(k==="MALE"?"/home-man":"/home-woman")}).catch(r=>{console.error("Error sending device token:",r)})):console.log("No registration token available. Request permission to generate one.")}).catch(c=>{console.error("An error occurred while retrieving token: ",c)}),typeof window.WebSocketConnect=="function"&&window.WebSocketConnect()}else y("登入失敗，請檢查網路或帳密")}catch(s){console.error(s),y("登入失敗，請稍後重試")}},F=[{country:"台灣 (Taiwan)",code:"+886"},{country:"中國 (China)",code:"+86"},{country:"新加坡 (Singapore)",code:"+65"},{country:"馬來西亞 (Malaysia)",code:"+60"},{country:"印尼 (Indonesia)",code:"+62"},{country:"泰國 (Thailand)",code:"+66"},{country:"菲律賓 (Philippines)",code:"+63"},{country:"越南 (Vietnam)",code:"+84"},{country:"汶萊 (Brunei)",code:"+673"},{country:"柬埔寨 (Cambodia)",code:"+855"},{country:"寮國 (Laos)",code:"+856"},{country:"緬甸 (Myanmar)",code:"+95"},{country:"美國 (United States)",code:"+1"},{country:"日本 (Japan)",code:"+81"},{country:"南韓 (South Korea)",code:"+82"},{country:"加拿大 (Canada)",code:"+1"},{country:"澳大利亞 (Australia)",code:"+61"},{country:"法國 (France)",code:"+33"},{country:"德國 (Germany)",code:"+49"},{country:"英國 (United Kingdom)",code:"+44"},{country:"義大利 (Italy)",code:"+39"},{country:"西班牙 (Spain)",code:"+34"},{country:"墨西哥 (Mexico)",code:"+52"},{country:"巴西 (Brazil)",code:"+55"},{country:"阿根廷 (Argentina)",code:"+54"},{country:"印度 (India)",code:"+91"},{country:"俄羅斯 (Russia)",code:"+7"},{country:"瑞士 (Switzerland)",code:"+41"},{country:"荷蘭 (Netherlands)",code:"+31"},{country:"南非 (South Africa)",code:"+27"},{country:"新西蘭 (New Zealand)",code:"+64"}];return e.jsxs(e.Fragment,{children:[e.jsx(X,{children:e.jsx("button",{className:"btn",onClick:()=>j("/home"),style:{background:"none",border:"none",color:"#fff"},children:e.jsx("i",{className:"mdi mdi-chevron-left",style:{fontSize:"24px"}})})}),e.jsxs("div",{className:"login-container",children:[e.jsx("h2",{className:"login-title",children:"輸入手機號碼與密碼登入"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"國家/地區"}),e.jsxs("select",{className:"form-input",value:n,onChange:s=>P(s.target.value),children:[e.jsx("option",{value:"",children:"請選擇"}),F.map((s,a)=>e.jsx("option",{value:s.code,children:s.country},a))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"手機號碼"}),e.jsxs("div",{className:"form-with-button",children:[e.jsx("span",{className:"input-prefix",style:{background:"#f0f0f0",padding:"4px 10px",border:"1px solid #ccc",borderRadius:"4px 0 0 4px",pointerEvents:"none"},children:n||"+0"}),e.jsx("input",{type:"number",className:"form-input",value:t,onChange:s=>I(s.target.value),placeholder:n===""?"請先選擇國家/地區":"",disabled:!n}),e.jsx("button",{className:"secondary-btn",onClick:U,disabled:t==="",children:"忘記密碼"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"密碼"}),e.jsxs("div",{className:"password-wrapper",children:[e.jsx("input",{className:"form-input",type:p?"text":"password",value:h,onChange:s=>$(s.target.value),placeholder:t===""?"請先輸入手機號碼":"",disabled:t===""}),e.jsx("i",{className:`mdi ${p?"mdi-eye-off":"mdi-eye"} eye-icon`,onClick:()=>A(!p)})]})]}),e.jsx("div",{className:"button-row",children:e.jsx("button",{className:"primary-btn",onClick:T,disabled:t===""||h==="",children:"登入"})}),N&&e.jsx("div",{className:"error-msg",children:N})]}),V&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{className:"close-btn",onClick:()=>w(!1),children:e.jsx("i",{className:"mdi mdi-close",style:{fontSize:"20px"}})}),e.jsx("h3",{className:"modal-title",children:"驗證碼"}),e.jsx("p",{children:"輸入驗證碼, 驗證成功後重設密碼"}),e.jsx("input",{className:"form-input",type:"text",value:g,onChange:s=>M(s.target.value),placeholder:"輸入驗證碼"}),e.jsxs("div",{className:"button-row",children:[e.jsx("button",{className:"secondary-btn",onClick:S,children:"重發驗證碼"}),e.jsx("button",{className:"primary-btn",onClick:B,disabled:g==="",children:"檢查驗證碼"})]}),v&&e.jsx("div",{className:"info-msg",children:v}),b&&e.jsx("div",{className:"error-msg",children:b})]})}),D&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{className:"close-btn",onClick:()=>x(!1),children:e.jsx("i",{className:"mdi mdi-close",style:{fontSize:"20px"}})}),e.jsx("h3",{className:"modal-title",children:"重設密碼"}),e.jsx("input",{className:"form-input",type:"password",value:l,onChange:s=>E(s.target.value),placeholder:"輸入新密碼"}),e.jsx("input",{className:"form-input",type:"password",value:f,onChange:s=>z(s.target.value),placeholder:"再輸入一次新密碼"}),e.jsx("div",{className:"button-row",children:e.jsx("button",{className:"primary-btn",onClick:L,disabled:l===""||f===""||l!==f,children:"重設密碼"})}),C&&e.jsx("div",{className:"error-msg",children:C})]})}),e.jsx(Y,{})]})};export { te as default };

