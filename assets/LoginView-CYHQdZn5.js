import{u as J,r as o,j as e}from"./index-B5A3E37t.js";import{a as l}from"./axios-upsvKRUO.js";import{A as Z}from"./AppBar-Ks0lJbdw.js";import{C as q}from"./CopyrightFooter-BZBRJ3MH.js";const ee=()=>{const x=J(),[H,S]=o.useState([]),[n,k]=o.useState(""),[t,_]=o.useState(""),[u,P]=o.useState(!1),[m,R]=o.useState(""),[g,p]=o.useState(""),[I,h]=o.useState(!1),[y,A]=o.useState(""),[j,c]=o.useState(""),[N,r]=o.useState(""),[V,w]=o.useState(!1),[i,$]=o.useState(""),[f,z]=o.useState(""),[b,d]=o.useState("");o.useEffect(()=>{window.AppConfig&&window.AppConfig.country_list&&S(window.AppConfig.country_list)},[]);const D=()=>{h(!0),v()},v=async()=>{try{c("");const s=await l.post(`https://api.dageiwo.com/auth/forget/send/sms_key?phone_number=${encodeURIComponent(n+t)}`,{});s.status===200&&s.data.success?c("發送成功，請輸入驗證碼"):c("發送驗證碼失敗，請稍後重試")}catch(s){console.error(s),c("發送驗證碼失敗，請檢查網路")}},E=async()=>{try{r("");const s=await l.post(`https://api.dageiwo.com/auth/check/sms_key?phone_number=${encodeURIComponent(n+t)}&key=${y}`,{});s.status===200&&s.data.success?(r("驗證碼正確！"),h(!1),w(!0)):r("驗證失敗，請重試")}catch(s){console.error(s),r("驗證失敗，請檢查網路")}},L=async()=>{try{d("");const s={phone_number:n+t,new_pwd:i},a=await l.post("https://api.dageiwo.com/auth/forget/pwd",s);a.status===200&&a.data.success?(d("重設成功，請使用新密碼登入"),w(!1)):d("重設密碼失敗，請稍後重試")}catch(s){console.error(s),d("重設密碼失敗，請檢查網路")}},M=async()=>{try{p("");const s=await l.post("https://api.dageiwo.com/auth/login",{account:n+t,password:m},{headers:{"Content-Type":"application/json"}});if(s.status===200&&s.data.success){const{nickname:a,gender_type:C,token:B,chat_id:F,chat_token:T,u_id:K,sendbird_user_id:W,sendbird_access_token:G}=s.data.data;window.sessionStorage.setItem("nickname",a),window.sessionStorage.setItem("gender_type",C),window.sessionStorage.setItem("token",B),window.sessionStorage.setItem("chat_id",F),window.sessionStorage.setItem("chat_token",T),window.sessionStorage.setItem("u_id",K),window.sessionStorage.setItem("sendbird_access_token",G),window.sessionStorage.setItem("sendbird_user_id",W),typeof window.WebSocketConnect=="function"&&window.WebSocketConnect(),x(C==="MALE"?"/home-man":"/home-woman")}else p("登入失敗，請檢查網路或帳密")}catch(s){console.error(s),p("登入失敗，請稍後重試")}},U=[{country:"台灣 (Taiwan)",code:"+886"},{country:"中國 (China)",code:"+86"},{country:"新加坡 (Singapore)",code:"+65"},{country:"馬來西亞 (Malaysia)",code:"+60"},{country:"印尼 (Indonesia)",code:"+62"},{country:"泰國 (Thailand)",code:"+66"},{country:"菲律賓 (Philippines)",code:"+63"},{country:"越南 (Vietnam)",code:"+84"},{country:"汶萊 (Brunei)",code:"+673"},{country:"柬埔寨 (Cambodia)",code:"+855"},{country:"寮國 (Laos)",code:"+856"},{country:"緬甸 (Myanmar)",code:"+95"},{country:"美國 (United States)",code:"+1"},{country:"日本 (Japan)",code:"+81"},{country:"南韓 (South Korea)",code:"+82"},{country:"加拿大 (Canada)",code:"+1"},{country:"澳大利亞 (Australia)",code:"+61"},{country:"法國 (France)",code:"+33"},{country:"德國 (Germany)",code:"+49"},{country:"英國 (United Kingdom)",code:"+44"},{country:"義大利 (Italy)",code:"+39"},{country:"西班牙 (Spain)",code:"+34"},{country:"墨西哥 (Mexico)",code:"+52"},{country:"巴西 (Brazil)",code:"+55"},{country:"阿根廷 (Argentina)",code:"+54"},{country:"印度 (India)",code:"+91"},{country:"俄羅斯 (Russia)",code:"+7"},{country:"瑞士 (Switzerland)",code:"+41"},{country:"荷蘭 (Netherlands)",code:"+31"},{country:"南非 (South Africa)",code:"+27"},{country:"新西蘭 (New Zealand)",code:"+64"}];return e.jsxs(e.Fragment,{children:[e.jsx(Z,{children:e.jsx("button",{className:"btn",onClick:()=>x("/home"),style:{background:"none",border:"none",color:"#fff"},children:e.jsx("i",{className:"mdi mdi-chevron-left",style:{fontSize:"24px"}})})}),e.jsxs("div",{className:"login-container",children:[e.jsx("h2",{className:"login-title",children:"輸入手機號碼與密碼登入"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"國家/地區"}),e.jsxs("select",{className:"form-input",value:n,onChange:s=>k(s.target.value),children:[e.jsx("option",{value:"",children:"請選擇"}),U.map((s,a)=>e.jsx("option",{value:s.code,children:s.country},a))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"手機號碼"}),e.jsxs("div",{className:"form-with-button",children:[e.jsx("span",{className:"input-prefix",style:{background:"#f0f0f0",padding:"4px 10px",border:"1px solid #ccc",borderRadius:"4px 0 0 4px",pointerEvents:"none"},children:n||"+0"}),e.jsx("input",{type:"number",className:"form-input",value:t,onChange:s=>_(s.target.value),placeholder:n===""?"請先選擇國家/地區":"",disabled:!n}),e.jsx("button",{className:"secondary-btn",onClick:D,disabled:t==="",children:"忘記密碼"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"密碼"}),e.jsxs("div",{className:"password-wrapper",children:[e.jsx("input",{className:"form-input",type:u?"text":"password",value:m,onChange:s=>R(s.target.value),placeholder:t===""?"請先輸入手機號碼":"",disabled:t===""}),e.jsx("i",{className:`mdi ${u?"mdi-eye-off":"mdi-eye"} eye-icon`,onClick:()=>P(!u)})]})]}),e.jsx("div",{className:"button-row",children:e.jsx("button",{className:"primary-btn",onClick:M,disabled:t===""||m==="",children:"登入"})}),g&&e.jsx("div",{className:"error-msg",children:g})]}),I&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{className:"close-btn",onClick:()=>h(!1),children:e.jsx("i",{className:"mdi mdi-close",style:{fontSize:"20px"}})}),e.jsx("h3",{className:"modal-title",children:"驗證碼"}),e.jsx("p",{children:"輸入驗證碼, 驗證成功後重設密碼"}),e.jsx("input",{className:"form-input",type:"text",value:y,onChange:s=>A(s.target.value),placeholder:"輸入驗證碼"}),e.jsxs("div",{className:"button-row",children:[e.jsx("button",{className:"secondary-btn",onClick:v,children:"重發驗證碼"}),e.jsx("button",{className:"primary-btn",onClick:E,disabled:y==="",children:"檢查驗證碼"})]}),j&&e.jsx("div",{className:"info-msg",children:j}),N&&e.jsx("div",{className:"error-msg",children:N})]})}),V&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{className:"close-btn",onClick:()=>w(!1),children:e.jsx("i",{className:"mdi mdi-close",style:{fontSize:"20px"}})}),e.jsx("h3",{className:"modal-title",children:"重設密碼"}),e.jsx("input",{className:"form-input",type:"password",value:i,onChange:s=>$(s.target.value),placeholder:"輸入新密碼"}),e.jsx("input",{className:"form-input",type:"password",value:f,onChange:s=>z(s.target.value),placeholder:"再輸入一次新密碼"}),e.jsx("div",{className:"button-row",children:e.jsx("button",{className:"primary-btn",onClick:L,disabled:i===""||f===""||i!==f,children:"重設密碼"})}),b&&e.jsx("div",{className:"error-msg",children:b})]})}),e.jsx(q,{})]})};export{ee as default};
