import{u as C,r as i,j as n}from"./index-DXM4gKHQ.js";import{a as W}from"./axios-upsvKRUO.js";import{A as E}from"./AppBar-C7IuuskN.js";import{C as N}from"./CopyrightFooter-BwePr1Sa.js";function H(){const a=C(),[R,c]=i.useState(window.innerWidth),[l,g]=i.useState(""),[_,u]=i.useState(""),[A,h]=i.useState(""),[G,m]=i.useState(""),[$,p]=i.useState(""),[z,x]=i.useState(""),[f,w]=i.useState([]),[y,j]=i.useState(1);i.useEffect(()=>{const s=()=>c(window.innerWidth);window.addEventListener("resize",s);const t=window.sessionStorage.getItem("gender_type")||"",e=window.sessionStorage.getItem("token")||"";if(h(t),g(e),u(window.sessionStorage.getItem("nickname")||""),m(window.sessionStorage.getItem("chat_id")||""),p(window.sessionStorage.getItem("chat_token")||""),x(window.sessionStorage.getItem("u_id")||""),t==="FEMALE"){a("/home-woman");return}if(!t){a("/home");return}return!window.WebSocketObject&&typeof window.WebSocketConnect=="function"&&window.WebSocketConnect(window.sessionStorage.getItem("u_id")),d(e,1),()=>{window.removeEventListener("resize",s)}},[]);const d=async(s,t)=>{try{const e=await W.get(`https://api.dageiwo.com/api/user/transactions_chat?page=${t}&limit=10&order=desc&sort=createTime`,{headers:{Authorization:`Bearer ${s}`}});if(e.status===200&&e.data.success){const r=S(e.data.data.records);e.data.data.records.length>0&&j(o=>o+1),w(o=>v(o,r))}}catch(e){console.error("RetrieveRecord error:",e)}},S=s=>{let t=[],e=null;return s.forEach(r=>{const o=k(r.create_time);(!e||e!==o)&&(e=o,t.push({date:o,list:[]})),t[t.length-1].list.push({time:I(r.create_time),coin:r.coin})}),t},v=(s,t)=>{let e=[...s];if(t.length===0)return e;if(e.length>0){const r=e[e.length-1],o=t[0];r.date===o.date&&(r.list=[...r.list,...o.list],t.shift())}return e=[...e,...t],e},k=s=>{if(!s)return"";const t=new Date(s);let e=(t.getMonth()+1).toString(),r=t.getDate().toString();const o=t.getFullYear();return e.length<2&&(e="0"+e),r.length<2&&(r="0"+r),`${o}/${e}/${r}`},I=s=>{if(!s)return"";const t=new Date(s),e=t.getHours()>11?"下午":"上午";let r=t.getHours().toString(),o=t.getMinutes().toString();return r.length<2&&(r="0"+r),o.length<2&&(o="0"+o),e+r+":"+o},b=s=>s?s.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"0",T=()=>{d(l,y)};return n.jsxs(n.Fragment,{children:[n.jsx(E,{children:n.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[n.jsx("button",{style:{background:"none",border:"none",color:"#fff",cursor:"pointer"},onClick:()=>a(-1),children:n.jsx("i",{className:"mdi mdi-chevron-left",style:{fontSize:"24px"}})}),n.jsx("h2",{style:{margin:"0 auto"},children:"消費紀錄(訊息)"})]})}),n.jsxs("div",{className:"transaction-record",style:{maxWidth:"800px",margin:"0 auto",padding:"1rem"},children:[f.map(s=>n.jsxs("div",{children:[n.jsx("div",{style:{padding:"15px 10px 5px 10px"},children:n.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[n.jsx("div",{style:{flex:1},children:s.date}),n.jsx("div",{style:{flex:1}})]})}),n.jsx("hr",{}),n.jsx("div",{style:{padding:"10px"},children:s.list.map(t=>n.jsxs("div",{style:{display:"flex",margin:"4px 0",alignItems:"center"},children:[n.jsx("div",{style:{flex:1}}),n.jsx("div",{style:{flex:2},children:t.time}),n.jsx("div",{style:{flex:1},children:"訊息"}),n.jsx("div",{style:{flex:1,textAlign:"right"},children:n.jsxs("h3",{style:{color:"#dd8ea4",margin:0},children:[b(t.coin)," 點"]})})]},t.time))})]},s.date)),n.jsx("button",{style:{backgroundColor:"#dd8ea4",color:"#fff",border:"none",borderRadius:"4px",padding:"8px 16px",cursor:"pointer",marginTop:"10px"},onClick:T,children:"查看更多"})]}),n.jsx(N,{})]})}export{H as default};
