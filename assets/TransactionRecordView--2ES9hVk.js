import{u as E,b as N,r as i,j as n}from"./index-D4cVrLXe.js";import{a as W}from"./axios-upsvKRUO.js";import{A as D}from"./AppBar-BIlMpYqp.js";import{C as _}from"./CopyrightFooter-BZd__YOl.js";function U(){const a=E(),{type:c}=N(),[L,u]=i.useState(window.innerWidth),[h,p]=i.useState(""),[z,m]=i.useState(""),[B,x]=i.useState(""),[F,f]=i.useState(""),[G,y]=i.useState(""),[M,w]=i.useState(""),[S,j]=i.useState([]),[v,k]=i.useState(1);i.useEffect(()=>{const s=()=>u(window.innerWidth);window.addEventListener("resize",s);const e=window.sessionStorage.getItem("token")||"";p(e),m(window.sessionStorage.getItem("nickname")||"");const t=window.sessionStorage.getItem("gender_type")||"";if(x(t),f(window.sessionStorage.getItem("chat_id")||""),y(window.sessionStorage.getItem("chat_token")||""),w(window.sessionStorage.getItem("u_id")||""),t==="FEMALE"){a("/home-woman");return}if(!t){a("/home");return}return!window.WebSocketObject&&typeof window.WebSocketConnect=="function"&&window.WebSocketConnect(window.sessionStorage.getItem("u_id")),l(e,1),()=>{window.removeEventListener("resize",s)}},[a,c]);const l=async(s,e)=>{try{const t=await W.get(`https://api.dageiwo.com/api/user/transactions?type=${c}&page=${e}&limit=10&order=desc&sort=createTime`,{headers:{Authorization:`Bearer ${s}`}});if(t.status===200&&t.data.success){const o=t.data.data.records;o.length>0&&k(d=>d+1);const r=I(o);j(d=>b(d,r))}}catch(t){console.error("RetrieveRecord error:",t)}},I=s=>{let e=[],t=null;return s.forEach(o=>{const r=T(o.create_time);(!t||t!==r)&&(t=r,e.push({date:r,list:[]})),e[e.length-1].list.push({time:C(o.create_time),seconds:o.seconds,type:o.type})}),e},b=(s,e)=>{if(e.length===0)return s;let t=[...s];if(t.length===0)return e;const o=t[t.length-1],r=e[0];return o.date===r.date&&(o.list=[...o.list,...r.list],e.shift()),t=[...t,...e],t},T=s=>{const e=new Date(s);let t=(e.getMonth()+1).toString(),o=e.getDate().toString();const r=e.getFullYear();return t.length<2&&(t="0"+t),o.length<2&&(o="0"+o),`${r}/${t}/${o}`},C=s=>{const e=new Date(s),t=e.getHours()>11?"下午":"上午";let o=e.getHours().toString(),r=e.getMinutes().toString();return o.length<2&&(o="0"+o),r.length<2&&(r="0"+r),`${t}${o}:${r}`},R=s=>s?s.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"",g=s=>{switch(s){case"CHAT":return"訊息";case"CALL":return"通話";case"VIDEO":return"直播";case"BONUS":return"禮物";default:return s}},$=()=>{l(h,v)};return n.jsxs(n.Fragment,{children:[n.jsx(D,{children:n.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[n.jsx("button",{style:{background:"none",border:"none",color:"#fff",cursor:"pointer"},onClick:()=>a(-1),children:n.jsx("i",{className:"mdi mdi-chevron-left",style:{fontSize:"24px"}})}),n.jsxs("h2",{style:{margin:"0 auto"},children:["消費紀錄(",g(c),")"]})]})}),n.jsxs("div",{className:"transaction-record",style:{maxWidth:"800px",margin:"0 auto",padding:"1rem"},children:[S.map(s=>n.jsxs("div",{children:[n.jsx("div",{style:{padding:"15px 10px 5px 10px"},children:n.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[n.jsx("div",{style:{flex:1},children:s.date}),n.jsx("div",{style:{flex:1}})]})}),n.jsx("hr",{}),n.jsx("div",{style:{padding:"10px"},children:s.list.map(e=>n.jsxs("div",{style:{display:"flex",margin:"4px 0",alignItems:"center"},children:[n.jsx("div",{style:{flex:1}}),n.jsx("div",{style:{flex:2},children:e.time}),n.jsx("div",{style:{flex:1},children:g(e.type)}),n.jsx("div",{style:{flex:1,textAlign:"right"},children:n.jsxs("h3",{style:{color:"#dd8ea4",margin:0},children:[R(e.seconds)," 秒"]})})]},e.time+e.type+e.seconds))})]},s.date)),n.jsx("button",{style:{backgroundColor:"#dd8ea4",color:"#fff",border:"none",borderRadius:"4px",padding:"8px 16px",cursor:"pointer",marginTop:"10px"},onClick:$,children:"查看更多"})]}),n.jsx(_,{})]})}export{U as default};
