import{u as Y,r as s,j as t,L as ee}from"./index-DJ0IS-oA.js";import{a as l}from"./axios-upsvKRUO.js";import{A as te}from"./AppBar-CL-OfsFA.js";import{C as se}from"./CopyrightFooter-BTH_ji-_.js";const le=()=>{const v=Y(),[I,b]=s.useState([]),[c,_]=s.useState(null),[h,$]=s.useState(""),[d,L]=s.useState(""),[j,N]=s.useState([]),[u,P]=s.useState(null),[r,w]=s.useState(""),[a,V]=s.useState(""),[f,F]=s.useState(!1),[y,M]=s.useState(""),[U,ae]=s.useState(""),[C,B]=s.useState(""),[E,S]=s.useState(""),[x,T]=s.useState(""),[z,n]=s.useState(""),[oe,k]=s.useState(!1),[D,m]=s.useState(""),[K,g]=s.useState(!1),[R,G]=s.useState(!1),[J,i]=s.useState("");s.useEffect(()=>{const e=window.sessionStorage.getItem("promotion_code")||"";S(e),window.AppConfig&&window.AppConfig.country_list&&N(window.AppConfig.country_list),window.AvatarList&&b(window.AvatarList),console.log(`promotion_code: ${e}`)},[]),s.useEffect(()=>{const e=window.sessionStorage.getItem("promotion_code")||"";S(e);const o=async()=>{try{const p=await l.get("https://api.dageiwo.com/auth/default/avatar");p.status===200&&p.data.success&&b(p.data.data)}catch(p){console.error("取得預設頭貼失敗:",p)}};N([{country:"台灣 (Taiwan)",code:"+886"},{country:"中國 (China)",code:"+86"},{country:"新加坡 (Singapore)",code:"+65"},{country:"馬來西亞 (Malaysia)",code:"+60"},{country:"印尼 (Indonesia)",code:"+62"},{country:"泰國 (Thailand)",code:"+66"},{country:"菲律賓 (Philippines)",code:"+63"},{country:"越南 (Vietnam)",code:"+84"},{country:"汶萊 (Brunei)",code:"+673"},{country:"柬埔寨 (Cambodia)",code:"+855"},{country:"寮國 (Laos)",code:"+856"},{country:"緬甸 (Myanmar)",code:"+95"},{country:"美國 (United States)",code:"+1"},{country:"日本 (Japan)",code:"+81"},{country:"南韓 (South Korea)",code:"+82"},{country:"加拿大 (Canada)",code:"+1"},{country:"澳大利亞 (Australia)",code:"+61"},{country:"法國 (France)",code:"+33"},{country:"德國 (Germany)",code:"+49"},{country:"英國 (United Kingdom)",code:"+44"},{country:"義大利 (Italy)",code:"+39"},{country:"西班牙 (Spain)",code:"+34"},{country:"墨西哥 (Mexico)",code:"+52"},{country:"巴西 (Brazil)",code:"+55"},{country:"阿根廷 (Argentina)",code:"+54"},{country:"印度 (India)",code:"+91"},{country:"俄羅斯 (Russia)",code:"+7"},{country:"瑞士 (Switzerland)",code:"+41"},{country:"荷蘭 (Netherlands)",code:"+31"},{country:"南非 (South Africa)",code:"+27"},{country:"新西蘭 (New Zealand)",code:"+64"}]),o()},[]);const O=e=>{c&&(c.isSelected=!1),_(e),e.isSelected=!0},Z=e=>{const o=j.find(A=>A.code===e);o&&(P(o),w(o.code))},q=e=>{V(e),n(""),m(""),g(!1)},H=async()=>{n(""),k(!1);try{const e=await l.get(`https://api.dageiwo.com/auth/check/account?account=${encodeURIComponent(r+a)}`);if(e.status!==200){n("發送驗證碼失敗, 請重新發送驗證碼.");return}if(!e.data.success){n("帳號已經存在, 請用其他手機號碼註冊.");return}}catch(e){console.error(e),n("發送驗證碼失敗, 請重新發送驗證碼.");return}try{const e=await l.post(`https://api.dageiwo.com/auth/send/sms_key?phone_number=${encodeURIComponent(r+a)}`,{});e.status===200&&e.data.success?(n("發送成功, 收到驗證碼之後請輸入驗證碼進行檢查."),k(!0)):n("發送驗證碼失敗, 請重新發送驗證碼.")}catch(e){console.error(e),n("發送驗證碼失敗, 請重新發送驗證碼.")}},Q=async()=>{m(""),g(!1);try{const e=await l.post(`https://api.dageiwo.com/auth/check/sms_key?phone_number=${encodeURIComponent(r+a)}&key=${x}`,{});e.status===200&&e.data.success?(m("檢查驗證碼成功."),g(!0)):m("檢查驗證碼失敗, 請重新發送驗證碼, 再進行檢查.")}catch(e){console.error(e),m("檢查驗證碼失敗, 請重新發送驗證碼, 再進行檢查.")}},W=s.useCallback(()=>{if(!d)return 0;const e=Math.abs(Date.now()-new Date(d).getTime());return Math.floor(e/(1e3*60*60*24*365.25))},[d]),X=async()=>{if(i(""),W()<18){i("註冊失敗, 年齡必須大於18.");return}try{const e=await l.get(`https://api.dageiwo.com/auth/check/account?account=${encodeURIComponent(r+a)}`);if(e.status!==200){i("註冊失敗, 請檢查網路後再試一次.");return}if(!e.data.success){i("帳號已經存在, 請用其他手機號碼註冊.");return}}catch(e){console.error(e),i("註冊失敗, 請檢查網路後再試一次.");return}try{const e=await l.post("https://api.dageiwo.com/auth/register",{country:(u==null?void 0:u.country)||"",account:r+a,password:y,nickname:h,birthday:d,referral_code:C,promotion_code:E||"",avatar_type:(c==null?void 0:c.type_name)||"",telegram_account:U},{headers:{"Content-Type":"application/json"}});e.status===200&&e.data.success?v("/login"):i("註冊失敗, 請檢查網路後再試一次.")}catch(e){console.error(e),i("註冊失敗, 請檢查網路後再試一次.")}};return t.jsxs(t.Fragment,{children:[t.jsx(te,{children:t.jsx("button",{className:"btn",style:{background:"none",border:"none",color:"#fff"},onClick:()=>v("/home"),children:t.jsx("i",{className:"mdi mdi-chevron-left",style:{fontSize:"24px"}})})}),t.jsxs("div",{className:"register-main",children:[t.jsx("h2",{children:"用手機號碼註冊"}),t.jsxs("div",{className:"form-row",children:[t.jsx("label",{className:"form-label",children:"虛擬頭像"}),t.jsx("div",{className:"avatar-list",children:I.map((e,o)=>t.jsxs("div",{className:`avatar-item ${e.isSelected?"selected":""}`,onClick:()=>O(e),children:[t.jsx("img",{src:e.url,alt:e.name,className:"avatar-img"}),t.jsx("div",{className:"avatar-name",children:e.name})]},o))})]}),t.jsxs("div",{className:"form-row",children:[t.jsx("label",{className:"form-label",children:"暱稱"}),t.jsx("input",{className:"form-input",type:"text",value:h,onChange:e=>$(e.target.value),disabled:!c,placeholder:c?"":"請先選擇虛擬頭像"})]}),t.jsxs("div",{className:"form-row",children:[t.jsx("label",{className:"form-label",children:"生日"}),t.jsx("input",{className:"form-input",type:"date",value:d,onChange:e=>L(e.target.value),max:new Date().toISOString().substring(0,10)})]}),t.jsxs("div",{className:"form-row",children:[t.jsx("label",{className:"form-label",children:"國家/地區"}),t.jsxs("select",{className:"form-select",value:r,onChange:e=>{w(e.target.value),Z(e.target.value)},disabled:h==="",children:[t.jsx("option",{value:"",children:h===""?"請先輸入暱稱":"請選擇"}),j.map((e,o)=>t.jsx("option",{value:e.code,children:e.country},o))]})]}),t.jsxs("div",{className:"form-row",style:{display:"flex",alignItems:"center"},children:[t.jsx("label",{className:"form-label",style:{marginRight:"10px"},children:"手機號碼"}),t.jsxs("div",{className:"input-container",style:{display:"flex",alignItems:"center",flex:1},children:[t.jsx("span",{className:"input-prefix",style:{background:"#f0f0f0",padding:"4px 10px",border:"1px solid #ccc",borderRadius:"4px 0 0 4px",pointerEvents:"none"},children:r||"+0"}),t.jsx("input",{className:"form-input",type:"number",value:a,onChange:e=>q(e.target.value),disabled:!u,placeholder:u?"":"請先選擇國家/地區",style:{flex:1,border:"1px solid #ccc",borderLeft:"none",marginLeft:"2px",borderRadius:"0 4px 4px 0"}})]})]}),t.jsxs("div",{className:"form-row",children:[t.jsx("label",{className:"form-label",children:"密碼"}),t.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[t.jsx("input",{className:"form-input",style:{width:"150px"},type:f?"text":"password",value:y,onChange:e=>M(e.target.value),disabled:a==="",placeholder:a===""?"請先輸入手機號":""}),t.jsx("button",{className:"btn",type:"button",onClick:()=>F(!f),children:f?"隱藏":"顯示"})]})]}),t.jsxs("div",{className:"verify-area",children:[t.jsx("span",{className:"tip-text",children:z}),t.jsx("button",{className:"btn",onClick:H,disabled:a==="",children:"發送驗證碼"})]}),t.jsxs("div",{className:"form-row",children:[t.jsx("label",{className:"form-label",children:"驗證碼"}),t.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[t.jsx("input",{className:"form-input",style:{width:"150px"},type:"number",value:x,onChange:e=>T(e.target.value),disabled:a==="",placeholder:a===""?"輸入手機驗證碼":""}),t.jsx("button",{className:"btn",onClick:Q,disabled:x==="",children:"檢查驗證碼"})]})]}),t.jsx("div",{className:"tip-text",children:D}),t.jsxs("div",{className:"form-row",children:[t.jsx("label",{className:"form-label",children:"介紹碼"}),t.jsx("input",{className:"form-input",type:"text",value:C,onChange:e=>B(e.target.value),disabled:a==="",placeholder:a===""?"請先輸入手機號碼":""})]}),t.jsx("div",{className:"form-row",children:t.jsxs("label",{style:{cursor:"pointer",display:"inline-flex",alignItems:"center"},children:[t.jsx("input",{type:"checkbox",checked:R,onChange:e=>G(e.target.checked)}),t.jsxs("span",{style:{marginLeft:"5px"},children:["我已閱讀並同意 ",t.jsx(ee,{to:"/service",children:"《服務協議》"})]})]})}),t.jsx("div",{className:"tip-text",style:{marginBottom:"1rem"},children:"本頁面收集的資料僅用於註冊帳戶"}),t.jsx("button",{className:"submit-btn",disabled:!K||y===""||!R,onClick:X,children:"同意並繼續"}),t.jsx("div",{className:"register-result",children:J})]}),t.jsx(se,{})]})};export{le as default};
