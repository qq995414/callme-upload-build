import{u as N,r as c,j as e}from"./index-BYUO2iQu.js";import{a as l}from"./axios-upsvKRUO.js";import{A as b}from"./AppBar-BtVt2au5.js";function C(){const i=N(),[d,m]=c.useState(null),[o,p]=c.useState("clary.option8j@icloud.c"),[h,u]=c.useState([]);c.useEffect(()=>{window.sessionStorage.getItem("nickname");const s=window.sessionStorage.getItem("gender_type"),a=window.sessionStorage.getItem("token");if(m(a),s==="FEMALE"){i("/home-woman");return}if(!s){i("/home");return}!window.WebSocketObject&&typeof window.WebSocketConnect=="function"&&window.WebSocketConnect(window.sessionStorage.getItem("u_id")),x()},[i]);const x=async()=>{try{const s=await l.get("https://api.dageiwo.com/index/recharge");s.data.success?u(s.data.data):console.error("获取充值选项失败:",s.data.message)}catch(s){console.error("请求充值选项失败:",s)}},g=async s=>{try{const a=await l.post("https://api.dageiwo.com/api/pay",{mail:o},{params:{recharge_type:s},headers:{Authorization:`Bearer ${d}`}});if(console.log(s),a.data.success){const{url:n,merchant_id:j,version:f,trade_info:w,trade_sha:v}=a.data.data,t=document.createElement("form");t.method="POST",t.action=n,t.appendChild(r("MerchantID",j)),t.appendChild(r("Version",f)),t.appendChild(r("TradeInfo",w)),t.appendChild(r("TradeSha",v)),document.body.appendChild(t),t.submit()}else alert(`儲值失敗: ${a.data.message||"請稍後再試"}`)}catch(a){console.error("充值請求失敗:",a),a.response?alert(`儲值失敗: ${a.response.data.message||"後端服務無響應"}`):a.request?alert("請求無響應，請檢查您的網路連線。"):alert("請求發生錯誤，請稍後再試。")}},r=(s,a)=>{const n=document.createElement("input");return n.type="hidden",n.name=s,n.value=a,n};return e.jsxs(e.Fragment,{children:[e.jsx(b,{children:e.jsxs("div",{className:"app-bar-content",children:[e.jsx("button",{className:"back-button",style:{color:"#fff"},onClick:()=>i(-1),children:e.jsx("i",{className:"mdi mdi-chevron-left",style:{fontSize:"24px"}})}),e.jsx("h2",{className:"app-bar-title",children:"金幣方案"}),e.jsx("div",{style:{width:"24px"}})]})}),e.jsxs("div",{className:"main-container",children:[e.jsxs("div",{className:"title-section",children:[e.jsx("p",{className:"main-title",children:"快用你的點數拓展"}),e.jsx("p",{className:"main-title",children:"你的交友圈吧！"})]}),e.jsx("div",{className:"recharge-options",children:h.map((s,a)=>e.jsxs("div",{className:"recharge-card",children:[e.jsx("div",{className:"card-title",children:"小資方案"}),e.jsxs("div",{className:"price-section",children:[e.jsxs("p",{className:"price",children:["$",s.price]}),e.jsxs("p",{className:"coins",children:["/ ",s.coins," 金幣"]})]}),e.jsx("button",{className:"buy-btn",onClick:()=>g(s.title),children:"立即購買"})]},a))}),e.jsxs("div",{className:"invoice-card",children:[e.jsx("h3",{children:"消費發票"}),e.jsxs("div",{className:"invoice-form",children:[e.jsx("label",{htmlFor:"email",children:"電子郵件"}),e.jsx("input",{type:"email",id:"email",placeholder:"請輸入你的電子郵件",value:o,onChange:s=>p(s.target.value)})]})]})]})]})}export{C as default};
