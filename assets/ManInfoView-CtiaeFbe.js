import{u as V,r as s,j as e}from"./index-B5A3E37t.js";import{a as h}from"./axios-upsvKRUO.js";import{A as q}from"./AppBar-Ks0lJbdw.js";import{C as Y}from"./CopyrightFooter-BZBRJ3MH.js";function re(){const n=V(),[c,k]=s.useState(window.innerWidth),[g,C]=s.useState(""),[H,S]=s.useState(""),[J,R]=s.useState(""),[K,I]=s.useState(""),[Q,N]=s.useState(""),[X,A]=s.useState(""),[o,l]=s.useState({}),[B,_]=s.useState(null),[T,x]=s.useState(!1),[w,p]=s.useState(null);s.useState(!1),s.useState(null);const[W,j]=s.useState(!1),[i,E]=s.useState(""),[a,P]=s.useState(""),[y,m]=s.useState(""),[u,D]=s.useState(!1);s.useEffect(()=>{const t=()=>k(window.innerWidth);window.addEventListener("resize",t);const r=window.sessionStorage.getItem("nickname")||"",d=window.sessionStorage.getItem("gender_type")||"",b=window.sessionStorage.getItem("token")||"",M=window.sessionStorage.getItem("chat_id")||"",G=window.sessionStorage.getItem("chat_token")||"",v=window.sessionStorage.getItem("u_id")||"";if(S(r),A(d),C(b),R(M),I(G),N(v),d==="FEMALE"){n("/home-woman");return}if(!d){n("/home");return}return!window.WebSocketObject&&typeof window.WebSocketConnect=="function"&&window.WebSocketConnect(v),L(b),()=>{window.removeEventListener("resize",t)}},[]),s.useCallback(()=>{let t=2;return c>960&&(t=3),((c>800?800:c)-30)/t},[c]);const $=t=>{if(t&&t!==""){const r=Date.now()-new Date(t).getTime(),d=new Date(r);return", "+Math.abs(d.getUTCFullYear()-1970).toString()+"歲"}return""},z=t=>t?t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"",L=async t=>{try{const r=await h.get("https://api.dageiwo.com/auth/info",{headers:{Authorization:`Bearer ${t}`}});r.status===200&&r.data.success&&(l(r.data.data),_(r.data.data.avatar_url))}catch(r){console.error("RetrieveInfo error:",r)}},f=async()=>{try{p(null);const t={nickname:o.nickname,birthday:o.birthday,notify_telegram:o.notify_telegram},r=await h.put("https://api.dageiwo.com/api/user",t,{headers:{Authorization:`Bearer ${g}`}});r.status===200&&r.data.success?(alert("更新成功！"),x(!1)):p("更新檔案發生錯誤, 請檢查網路後重試一次.")}catch(t){console.error("UpdateInfo error:",t),p("更新檔案發生錯誤, 請檢查網路後重試一次.")}},F=async()=>{try{m("");const t={phone_number:"someNumber",new_pwd:i},r=await h.post("https://api.dageiwo.com/auth/forget/pwd",t);r.status===200&&r.data.success?(m("重設密碼成功."),j(!1)):m("重設密碼失敗, 請檢查網路, 再試一次.")}catch(t){console.error("ResetPassword error:",t),m("重設密碼失敗, 請檢查網路, 再試一次.")}},U=()=>{window.location.assign("https://line.me/R/ti/p/@668pwyqo")},O=async()=>{try{const t=await h.post("https://api.dageiwo.com/auth/logout",{},{headers:{Authorization:`Bearer ${g}`}});t.status===200&&t.data.success&&(window.sessionStorage.setItem("nickname",""),window.sessionStorage.setItem("gender_type",""),window.sessionStorage.setItem("token",""),window.sessionStorage.setItem("chat_id",""),window.sessionStorage.setItem("chat_token",""),window.sessionStorage.setItem("u_id",""),window.WebSocketObject&&window.WebSocketObject.close(),n("/home"))}catch(t){console.error("logout error:",t),n("/home")}};return e.jsxs(e.Fragment,{children:[e.jsx(q,{children:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx("button",{style:{background:"none",border:"none",color:"#fff",cursor:"pointer"},onClick:()=>n(-1),children:e.jsx("i",{className:"mdi mdi-chevron-left",style:{fontSize:"24px"}})}),e.jsx("h2",{style:{margin:"0 auto"},children:"個人檔案"})]})}),o&&e.jsxs("div",{className:"info-main",style:{maxWidth:"800px",margin:"0 auto",padding:"1rem"},children:[e.jsxs("div",{style:{display:"flex",marginBottom:"1rem",alignItems:"center"},children:[e.jsx("div",{style:{flex:"0 0 auto",marginRight:"20px"},children:e.jsx("div",{style:{width:"96px",height:"96px",borderRadius:"50%",border:"2px solid #f2e9eb",outline:"#dd8ea4 solid 2px",overflow:"hidden"},children:e.jsx("img",{src:B||"/images/placeholder.png",alt:"Avatar",style:{width:"100%",height:"100%",objectFit:"cover"}})})}),e.jsx("div",{children:e.jsxs("h3",{children:[o.nickname,$(o.birthday)]})}),e.jsx("div",{style:{marginLeft:"auto"},children:e.jsx("button",{style:{borderRadius:"4px",backgroundColor:"#dd8ea4",color:"#fff",border:"none",padding:"8px 16px",cursor:"pointer"},onClick:()=>x(!0),children:"編輯檔案"})})]}),e.jsx("div",{style:{margin:"20px 5px 10px 5px",display:"flex",justifyContent:"center"},children:e.jsxs("div",{style:{background:"#fff",borderRadius:"16px",width:"90%",padding:"1rem"},children:[e.jsx("div",{style:{textAlign:"center",marginBottom:"1rem",color:"purple"},children:e.jsx("h3",{children:"金幣"})}),e.jsx("div",{style:{textAlign:"center",marginBottom:"1rem"},children:e.jsxs("h1",{children:[z(o.coin),"點"]})}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx("button",{style:{borderRadius:"8px",backgroundColor:"#dd8ea4",color:"#fff",border:"none",padding:"8px 16px",width:"80%",cursor:"pointer"},onClick:()=>n("/purchase/deposit"),children:e.jsx("h3",{children:"前往儲值"})})})]})}),e.jsx("div",{style:{margin:"5px",display:"flex",justifyContent:"center"},children:e.jsxs("div",{style:{background:"#fff",borderRadius:"16px",width:"90%",padding:"1rem"},children:[e.jsxs("div",{className:"menu-item",onClick:()=>n("/deposit-record"),children:[e.jsx("h3",{children:"金幣紀錄"}),e.jsx("i",{className:"mdi mdi-chevron-right"})]}),e.jsxs("div",{className:"menu-item",onClick:()=>D(!u),style:{cursor:"pointer"},children:[e.jsx("h3",{children:"紀錄"}),e.jsx("i",{className:`mdi mdi-chevron-${u?"down":"right"}`})]}),u&&e.jsxs("div",{style:{paddingLeft:"1rem"},children:[e.jsx("div",{className:"submenu-item",onClick:()=>n("/transactions-chat-record"),style:{padding:"8px 0",borderBottom:"1px solid #ccc",cursor:"pointer"},children:e.jsx("h4",{children:"訊息紀錄"})}),e.jsx("div",{className:"submenu-item",onClick:()=>n("/transactions-record/CALL"),style:{padding:"8px 0",borderBottom:"1px solid #ccc",cursor:"pointer"},children:e.jsx("h4",{children:"通話紀錄"})}),e.jsx("div",{className:"submenu-item",onClick:()=>n("/transactions-record/VIDEO"),style:{padding:"8px 0",cursor:"pointer"},children:e.jsx("h4",{children:"直播紀錄"})})]}),e.jsx("hr",{}),e.jsxs("div",{className:"menu-item",children:[e.jsx("h3",{children:"通知開關"}),e.jsx("input",{type:"checkbox",checked:o.notify_telegram||!1,onChange:()=>{const t={...o,notify_telegram:!o.notify_telegram};l(t)}})]}),e.jsx("hr",{}),e.jsxs("div",{className:"menu-item",onClick:U,children:[e.jsx("h3",{children:"聯絡客服"}),e.jsx("i",{className:"mdi mdi-chevron-right"})]}),e.jsx("div",{style:{textAlign:"center",marginTop:"1rem"},children:e.jsx("button",{style:{backgroundColor:"#dd8ea4",color:"#fff",border:"none",padding:"8px 16px",borderRadius:"4px",cursor:"pointer"},onClick:f,children:"送出"})}),e.jsx("div",{style:{textAlign:"center",marginTop:"1rem"},children:e.jsx("button",{style:{borderRadius:"8px",background:"none",color:"#dd8ea4",border:"2px solid #dd8ea4",padding:"8px 16px",width:"80%",cursor:"pointer"},onClick:O,children:e.jsx("h3",{children:"登出"})})})]})})]}),T&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{className:"modal-close",onClick:()=>x(!1),children:e.jsx("i",{className:"mdi mdi-close"})}),e.jsx("h3",{style:{textAlign:"center"},children:"修改個人檔案"}),e.jsxs("div",{style:{margin:"10px"},children:[e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"4px"},children:"暱稱"}),e.jsx("input",{type:"text",style:{width:"100%",padding:"0.5rem",borderRadius:"4px",border:"1px solid #ccc"},value:o.nickname||"",onChange:t=>l({...o,nickname:t.target.value})})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"4px"},children:"生日"}),e.jsx("input",{type:"date",style:{width:"100%",padding:"0.5rem",borderRadius:"4px",border:"1px solid #ccc"},value:o.birthday||"",onChange:t=>l({...o,birthday:t.target.value})})]}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx("button",{style:{backgroundColor:"#dd8ea4",color:"#fff",padding:"8px 16px",border:"none",borderRadius:"4px",cursor:"pointer"},onClick:f,children:"儲存"})}),w&&e.jsx("div",{style:{textAlign:"center",color:"red",marginTop:"1rem"},children:w})]})]})}),W&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{className:"modal-close",onClick:()=>j(!1),children:e.jsx("i",{className:"mdi mdi-close"})}),e.jsx("h3",{style:{textAlign:"center"},children:"重設密碼"}),e.jsxs("div",{style:{margin:"10px"},children:[e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"4px"},children:"輸入新密碼"}),e.jsx("input",{type:"password",style:{width:"100%",padding:"0.5rem",borderRadius:"4px",border:"1px solid #ccc"},value:i,onChange:t=>E(t.target.value)})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"4px"},children:"再輸入一次新密碼"}),e.jsx("input",{type:"password",style:{width:"100%",padding:"0.5rem",borderRadius:"4px",border:"1px solid #ccc"},value:a,onChange:t=>P(t.target.value)})]}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx("button",{style:{backgroundColor:i!==""&&a!==""&&i===a?"#dd8ea4":"#ccc",color:"#fff",padding:"8px 16px",border:"none",borderRadius:"4px",cursor:i!==""&&a!==""&&i===a?"pointer":"not-allowed"},onClick:F,disabled:i===""||a===""||i!==a,children:"重設密碼"})}),y&&e.jsx("div",{style:{textAlign:"center",color:"red",marginTop:"1rem"},children:y})]})]})}),e.jsx(Y,{})]})}export{re as default};
