import { A as Y } from "./AppBar-CL-OfsFA.js";
import { a as l } from "./axios-upsvKRUO.js";
import { j as e, a as H, u as O, r as o } from "./index-DJ0IS-oA.js";
function se(){const{id:h}=H(),i=O(),[r,k]=o.useState(window.innerWidth),[d,v]=o.useState(""),[q,_]=o.useState(""),[J,C]=o.useState(""),[K,S]=o.useState(""),[N,R]=o.useState(""),[Q,I]=o.useState(""),[s,W]=o.useState({}),[A,z]=o.useState(null),[m,c]=o.useState(!1),[D,$]=o.useState([]),[P,B]=o.useState([]),[E,u]=o.useState(!1),[T,f]=o.useState(!1),[F,g]=o.useState(!1),[V,X]=o.useState("");o.useEffect(()=>{_(window.localStorage.getItem("nickname")||""),I(window.localStorage.getItem("gender_type")||"");const t=window.localStorage.getItem("token")||"";v(t),C(window.localStorage.getItem("chat_id")||""),S(window.localStorage.getItem("chat_token")||""),R(window.localStorage.getItem("u_id")||""),!window.WebSocketObject&&typeof window.WebSocketConnect=="function"&&window.WebSocketConnect(window.localStorage.getItem("u_id")),U(t)},[h]),o.useEffect(()=>{const t=()=>k(window.innerWidth);return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]);const b=o.useCallback(()=>{let t=2;return r>960&&(t=3),((r>800?800:r)-30)/t},[r]),L=t=>{if(t){const n=Date.now()-new Date(t).getTime(),a=new Date(n);return" "+Math.abs(a.getUTCFullYear()-1970)}return""},U=async t=>{try{const n=await l.get(`https://api.dageiwo.com/index/detail/${h}`,{headers:{Authorization:`Bearer ${t}`}});if(n.status===200&&n.data.success){const a=n.data.data;W(a),c(a.is_following),a.statement&&$(a.statement.split(",")),a.appearance&&B(a.appearance.split(","));let y="";for(let x=0;x<a.img_responses.length;x++){const w=a.img_responses[x];if(w.status!=="PENDING"){y=w.image_url;break}}z(y)}}catch(n){console.error("RetrieveInfo error:",n)}},j=async()=>{try{if(m){const t=await l.delete(`https://api.dageiwo.com/api/user/follow?host_id=${s.id}`,{headers:{Authorization:`Bearer ${d}`}});t.status===200&&t.data.success&&c(!1)}else{const t=await l.post(`https://api.dageiwo.com/api/user/follow?host_id=${s.id}`,{},{headers:{Authorization:`Bearer ${d}`}});t.status===200&&t.data.success&&c(!0)}}catch(t){console.error("Follow error:",t),alert("操作失敗，請稍後再試")}},G=async()=>{p()},M=async()=>{p()},p=async()=>{try{const t=await l.post("https://api.dageiwo.com/api/chat/create_or_get",null,{params:{sender_id:N,recipient_id:s.id},headers:{Authorization:`Bearer ${d}`}});if(t.status===200&&t.data.success){const n=t.data.data;i(`/man-chat-list/${n.channel_url}`)}else console.error("API 回傳錯誤:",t.data.message),alert("無法建立聊天室，請稍後再試")}catch(t){console.error("API 請求失敗:",t),alert("建立聊天室失敗，請稍後再試！")}};return e.jsxs(e.Fragment,{children:[e.jsx(Y,{children:e.jsx("button",{style:{background:"none",border:"none",color:"#fff",cursor:"pointer"},onClick:()=>i("/home"),children:e.jsx("i",{className:"mdi mdi-chevron-left",style:{fontSize:"24px"}})})}),s&&e.jsxs("div",{className:"info-main",style:{maxWidth:"800px",margin:"0 auto",padding:"1rem"},children:[e.jsx("div",{style:{borderRadius:"16px",overflow:"hidden",marginBottom:"1rem"},children:e.jsx("img",{src:A||"/images/placeholder.png",alt:"main",style:{width:"100%",height:b()*2,objectFit:"cover"}})}),e.jsxs("div",{style:{display:"flex",margin:"5px 0"},children:[e.jsx("h2",{style:{flex:1},children:s.nickname}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:m?e.jsx("button",{className:"dis-follow-btn",onClick:j,children:"取消關注"}):e.jsx("button",{className:"follow-btn",onClick:j,children:"關注對方"})})]}),e.jsxs("div",{style:{margin:"4px 0",fontSize:"14px"},children:[L(s.birthday)," 歲"]}),e.jsxs("div",{style:{margin:"4px 0"},children:[!s.cannot_take_call&&e.jsx("span",{style:{backgroundColor:"purple",color:"#fff",padding:"2px 6px",marginRight:"4px",fontSize:"12px",borderRadius:"4px"},children:"語音"}),!s.cannot_take_video_call&&e.jsx("span",{style:{backgroundColor:"cyan",color:"#fff",padding:"2px 6px",fontSize:"12px",borderRadius:"4px"},children:"視訊"})]}),e.jsx("div",{style:{margin:"10px 0 4px 0",fontWeight:"bold"},children:"自我介紹"}),e.jsx("div",{style:{fontSize:"14px"},children:s.about_me}),e.jsx("div",{style:{margin:"10px 0 4px 0",fontWeight:"bold"},children:"我先聲明"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:D.map((t,n)=>e.jsxs("span",{style:{backgroundColor:"#dd8ea4",color:"#fff",padding:"2px 6px",borderRadius:"4px",fontSize:"12px"},children:["#",t]},n))}),e.jsx("div",{style:{margin:"10px 0 4px 0",fontWeight:"bold"},children:"外型"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:P.map((t,n)=>e.jsxs("span",{style:{backgroundColor:"#dd8ea4",color:"#fff",padding:"2px 6px",borderRadius:"4px",fontSize:"12px"},children:["#",t]},n))}),e.jsx("div",{style:{margin:"10px 0 4px 0",fontWeight:"bold"},children:"語音留言"}),e.jsx("audio",{controls:!0,src:s.mp3_url||"",style:{width:"100%"}}),e.jsx("div",{className:"female-member-list",children:s.img_responses&&s.img_responses.map((t,n)=>{const a=t.status==="PENDING";return e.jsx("div",{children:e.jsxs("div",{style:{position:"relative",borderRadius:"16px",overflow:"hidden"},children:[e.jsx("img",{src:t.image_url||"/images/placeholder.png",alt:"sub",style:{width:"100%",height:b(),objectFit:"cover",filter:a?"blur(8px)":"none",transform:a?"scale(0.95)":"scale(1)"}}),a&&e.jsx("div",{className:"approving",children:"審查中"})]})},n)})})]}),s&&e.jsxs("div",{style:{position:"fixed",bottom:0,left:0,width:"100%",background:"linear-gradient(rgba(255,255,255,0) 0%, rgba(255,255,255,1) 50%)",display:"flex",justifyContent:"center",padding:"8px 0",marginBottom:"60px"},children:[e.jsx("button",{style:{backgroundColor:"#fff",border:"none",width:"50px",height:"50px",borderRadius:"50%",margin:"0 10px",cursor:s.cannot_take_call?"not-allowed":"pointer"},disabled:s.cannot_take_call,onClick:()=>u(!0),children:e.jsx("i",{className:"mdi mdi-phone-in-talk",style:{color:"purple",fontSize:"24px"}})}),e.jsx("button",{style:{backgroundColor:"#dd8ea4",border:"none",width:"50px",height:"50px",borderRadius:"50%",margin:"0 10px",cursor:"pointer"},onClick:p,children:e.jsx("i",{className:"mdi mdi-chat-processing-outline",style:{color:"#fff",fontSize:"24px"}})}),e.jsx("button",{style:{backgroundColor:"#fff",border:"none",width:"50px",height:"50px",borderRadius:"50%",margin:"0 10px",cursor:s.cannot_take_video_call?"not-allowed":"pointer"},disabled:s.cannot_take_video_call,onClick:()=>f(!0),children:e.jsx("i",{className:"mdi mdi-video",style:{color:"blue",fontSize:"24px"}})})]}),E&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{className:"modal-close",onClick:()=>u(!1),children:e.jsx("i",{className:"mdi mdi-close"})}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("img",{src:"../src/assets/通話費率.png",alt:"通話費率",style:{maxWidth:"120px"}}),e.jsxs("p",{children:["將以每",e.jsxs("span",{style:{fontWeight:"bolder"},children:[s.call_coin,"點/分鐘"]}),"扣點進行語音通話"]}),e.jsx("button",{style:{backgroundColor:"#dd8ea4",color:"#fff",padding:"8px 16px",borderRadius:"4px",border:"none",margin:"0.5rem 0",width:"100%"},onClick:G,children:"確定"}),e.jsx("button",{style:{backgroundColor:"#fff",color:"#dd8ea4",padding:"8px 16px",borderRadius:"4px",border:"2px solid #dd8ea4",width:"100%"},onClick:()=>i("/purchase/deposit"),children:"前往加值"})]})]})}),T&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{className:"modal-close",onClick:()=>f(!1),children:e.jsx("i",{className:"mdi mdi-close"})}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("img",{src:"../src/assets/視訊費率.png",alt:"視訊費率",style:{maxWidth:"120px"}}),e.jsxs("p",{children:["將以每",e.jsxs("span",{style:{fontWeight:"bolder"},children:[s.video_coin,"點/分鐘"]}),"扣點進行視訊通話"]}),e.jsx("button",{style:{backgroundColor:"#dd8ea4",color:"#fff",padding:"8px 16px",borderRadius:"4px",border:"none",margin:"0.5rem 0",width:"100%"},onClick:M,children:"確定"}),e.jsx("button",{style:{backgroundColor:"#fff",color:"#dd8ea4",padding:"8px 16px",borderRadius:"4px",border:"2px solid #dd8ea4",width:"100%"},onClick:()=>i("/purchase/deposit"),children:"前往加值"})]})]})}),F&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{className:"modal-close",onClick:()=>g(!1),children:e.jsx("i",{className:"mdi mdi-close"})}),e.jsx("h3",{style:{textAlign:"center"},children:"打開 APP"}),e.jsx("p",{style:{textAlign:"center"},children:"偵測到已安裝 APP，請點擊按鈕打開。"}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[e.jsx("button",{style:{background:"none",border:"none",cursor:"pointer",color:"#555"},onClick:()=>g(!1),children:"取消"}),e.jsx("a",{href:V,style:{textDecoration:"none"},children:e.jsx("button",{style:{backgroundColor:"#dd8ea4",color:"#fff",border:"none",padding:"8px 16px",borderRadius:"4px"},children:"確定"})})]})]})})]})}export { se as default };

