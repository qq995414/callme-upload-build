import{u as Z,r as s,j as e,a as H}from"./index-BG8ls1W1.js";import{a as r}from"./axios-upsvKRUO.js";import{A as O}from"./AppBar-DDHEgYTa.js";import{C as Q}from"./CopyrightFooter-D8qVg-lt.js";const te=()=>{const g=Z(),[X,_]=s.useState([]),[a,P]=s.useState(""),[t,R]=s.useState(""),[m,I]=s.useState(!1),[p,A]=s.useState(""),[j,h]=s.useState(""),[$,y]=s.useState(!1),[w,T]=s.useState(""),[N,i]=s.useState(""),[b,d]=s.useState(""),[V,f]=s.useState(!1),[l,D]=s.useState(""),[x,z]=s.useState(""),[v,u]=s.useState("");s.useEffect(()=>{window.AppConfig&&window.AppConfig.country_list&&_(window.AppConfig.country_list)},[]);const E=()=>{y(!0),C()},C=async()=>{try{i("");const o=await r.post(`https://api.dageiwo.com/auth/forget/send/sms_key?phone_number=${encodeURIComponent(a+t)}`,{});o.status===200&&o.data.success?i("發送成功，請輸入驗證碼"):i("發送驗證碼失敗，請稍後重試")}catch(o){console.error(o),i("發送驗證碼失敗，請檢查網路")}},L=async()=>{try{d("");const o=await r.post(`https://api.dageiwo.com/auth/check/sms_key?phone_number=${encodeURIComponent(a+t)}&key=${w}`,{});o.status===200&&o.data.success?(d("驗證碼正確！"),y(!1),f(!0)):d("驗證失敗，請重試")}catch(o){console.error(o),d("驗證失敗，請檢查網路")}},M=async()=>{try{u("");const o={phone_number:a+t,new_pwd:l},n=await r.post("https://api.dageiwo.com/auth/forget/pwd",o);n.status===200&&n.data.success?(u("重設成功，請使用新密碼登入"),f(!1)):u("重設密碼失敗，請稍後重試")}catch(o){console.error(o),u("重設密碼失敗，請檢查網路")}},B=async()=>{try{h("");const o=await r.post("https://api.dageiwo.com/auth/login",{account:a+t,password:p},{headers:{"Content-Type":"application/json"}});if(o.status===200&&o.data.success){const{nickname:n,gender_type:c,token:S,chat_id:K,chat_token:W,u_id:q,sendbird_user_id:G,sendbird_access_token:J}=o.data.data;window.localStorage.setItem("nickname",n),window.localStorage.setItem("gender_type",c),window.localStorage.setItem("token",S),window.localStorage.setItem("chat_id",K),window.localStorage.setItem("chat_token",W),window.localStorage.setItem("u_id",q),window.localStorage.setItem("sendbird_access_token",J),window.localStorage.setItem("sendbird_user_id",G);const k=await H();k&&await F(S,k),typeof window.WebSocketConnect=="function"&&window.WebSocketConnect(),g(c==="MALE"?"/home-man":"/home-woman")}else h("登入失敗，請檢查網路或帳密")}catch(o){console.error(o),h("登入失敗，請稍後重試")}},F=async(o,n)=>{try{const c=await r.put("https://api.dageiwo.com/api/user/device_token",{},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},params:{device_token:n}});console.log("✅ Device Token 更新成功:",c.data)}catch(c){console.error("❌ Device Token 更新失敗:",c)}},U=[{country:"台灣 (Taiwan)",code:"+886"},{country:"中國 (China)",code:"+86"},{country:"新加坡 (Singapore)",code:"+65"},{country:"馬來西亞 (Malaysia)",code:"+60"},{country:"印尼 (Indonesia)",code:"+62"},{country:"泰國 (Thailand)",code:"+66"},{country:"菲律賓 (Philippines)",code:"+63"},{country:"越南 (Vietnam)",code:"+84"},{country:"汶萊 (Brunei)",code:"+673"},{country:"柬埔寨 (Cambodia)",code:"+855"},{country:"寮國 (Laos)",code:"+856"},{country:"緬甸 (Myanmar)",code:"+95"},{country:"美國 (United States)",code:"+1"},{country:"日本 (Japan)",code:"+81"},{country:"南韓 (South Korea)",code:"+82"},{country:"加拿大 (Canada)",code:"+1"},{country:"澳大利亞 (Australia)",code:"+61"},{country:"法國 (France)",code:"+33"},{country:"德國 (Germany)",code:"+49"},{country:"英國 (United Kingdom)",code:"+44"},{country:"義大利 (Italy)",code:"+39"},{country:"西班牙 (Spain)",code:"+34"},{country:"墨西哥 (Mexico)",code:"+52"},{country:"巴西 (Brazil)",code:"+55"},{country:"阿根廷 (Argentina)",code:"+54"},{country:"印度 (India)",code:"+91"},{country:"俄羅斯 (Russia)",code:"+7"},{country:"瑞士 (Switzerland)",code:"+41"},{country:"荷蘭 (Netherlands)",code:"+31"},{country:"南非 (South Africa)",code:"+27"},{country:"新西蘭 (New Zealand)",code:"+64"}];return e.jsxs(e.Fragment,{children:[e.jsx(O,{children:e.jsx("button",{className:"btn",onClick:()=>g("/home"),style:{background:"none",border:"none",color:"#fff"},children:e.jsx("i",{className:"mdi mdi-chevron-left",style:{fontSize:"24px"}})})}),e.jsxs("div",{className:"login-container",children:[e.jsx("h2",{className:"login-title",children:"輸入手機號碼與密碼登入"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"國家/地區"}),e.jsxs("select",{className:"form-input",value:a,onChange:o=>P(o.target.value),children:[e.jsx("option",{value:"",children:"請選擇"}),U.map((o,n)=>e.jsx("option",{value:o.code,children:o.country},n))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"手機號碼"}),e.jsxs("div",{className:"form-with-button",children:[e.jsx("span",{className:"input-prefix",style:{background:"#f0f0f0",padding:"4px 10px",border:"1px solid #ccc",borderRadius:"4px 0 0 4px",pointerEvents:"none"},children:a||"+0"}),e.jsx("input",{type:"number",className:"form-input",value:t,onChange:o=>R(o.target.value),placeholder:a===""?"請先選擇國家/地區":"",disabled:!a}),e.jsx("button",{className:"secondary-btn",onClick:E,disabled:t==="",children:"忘記密碼"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"密碼"}),e.jsxs("div",{className:"password-wrapper",children:[e.jsx("input",{className:"form-input",type:m?"text":"password",value:p,onChange:o=>A(o.target.value),placeholder:t===""?"請先輸入手機號碼":"",disabled:t===""}),e.jsx("i",{className:`mdi ${m?"mdi-eye-off":"mdi-eye"} eye-icon`,onClick:()=>I(!m)})]})]}),e.jsx("div",{className:"button-row",children:e.jsx("button",{className:"primary-btn",onClick:B,disabled:t===""||p==="",children:"登入"})}),j&&e.jsx("div",{className:"error-msg",children:j})]}),$&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{className:"close-btn",onClick:()=>y(!1),children:e.jsx("i",{className:"mdi mdi-close",style:{fontSize:"20px"}})}),e.jsx("h3",{className:"modal-title",children:"驗證碼"}),e.jsx("p",{children:"輸入驗證碼, 驗證成功後重設密碼"}),e.jsx("input",{className:"form-input",type:"text",value:w,onChange:o=>T(o.target.value),placeholder:"輸入驗證碼"}),e.jsxs("div",{className:"button-row",children:[e.jsx("button",{className:"secondary-btn",onClick:C,children:"重發驗證碼"}),e.jsx("button",{className:"primary-btn",onClick:L,disabled:w==="",children:"檢查驗證碼"})]}),N&&e.jsx("div",{className:"info-msg",children:N}),b&&e.jsx("div",{className:"error-msg",children:b})]})}),V&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{className:"close-btn",onClick:()=>f(!1),children:e.jsx("i",{className:"mdi mdi-close",style:{fontSize:"20px"}})}),e.jsx("h3",{className:"modal-title",children:"重設密碼"}),e.jsx("input",{className:"form-input",type:"password",value:l,onChange:o=>D(o.target.value),placeholder:"輸入新密碼"}),e.jsx("input",{className:"form-input",type:"password",value:x,onChange:o=>z(o.target.value),placeholder:"再輸入一次新密碼"}),e.jsx("div",{className:"button-row",children:e.jsx("button",{className:"primary-btn",onClick:M,disabled:l===""||x===""||l!==x,children:"重設密碼"})}),v&&e.jsx("div",{className:"error-msg",children:v})]})}),e.jsx(Q,{})]})};export{te as default};
